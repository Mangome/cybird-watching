# CybirdWatching 更新日志

## [Unreleased] - 字体动态加载优化

### ✨ 新特性
- **字体从 SD 卡动态加载**
  - 使用 LVGL 原生 binfont API (lv_binfont_create)
  - 字体文件存放在 SD 卡 `/fonts/` 目录
  - 支持运行时动态加载和切换字体
  - LVGL 自动管理字形缓存，按需加载

### 🎯 优化改进
- **大幅降低固件体积**
  - 移除固件内置字体：~281KB Flash
  - 移除 lv_font_notosanssc_12/16/18 C 数组文件
  - 固件 Flash 使用率降低约 21%

- **内存优化**
  - RAM 占用仅增加 ~20-50KB（LVGL 缓存）
  - 相比固件内置方案，总内存持平
  - 不再需要大量 Flash 空间

- **字体管理灵活性提升**
  - 新增 FontManager 类统一管理字体
  - 支持多字体并存和动态切换
  - 字体更新无需重新烧录固件
  - 完善的错误处理和日志记录

### 📝 文档更新
- 新增 `docs/FONT_CONVERSION_GUIDE.md` - 字体转换完整指南
- 新增 `docs/FONT_LOADING_TEST.md` - 测试指南
- 新增 `resources/fonts/README.md` - 字体文件生成说明

### 🔧 技术变更
- 新增 `font_manager.h/cpp` - 字体动态加载器
- 更新 `setup_scr_scenes.c` - 使用动态字体加载
- 更新 `guider_fonts.h` - 移除固件字体声明

### 📦 依赖变化
- 依赖 LVGL binfont 支持（已启用）
- 依赖 SD 卡文件系统驱动器 'S:'

---

## [1.1.0] - 2025-12-16

### ✨ ESP32-S3 平台支持

#### 新增特性
- **ESP32-S3 DevKitC-1 支持**
  - 新增 `esp32-s3-devkitc-1` 编译环境
  - 完整的 ESP32-S3 专用引脚映射配置
  - 编译时自动平台识别 (`PLATFORM_ESP32_S3` 宏)

- **SD 卡 SDMMC 高速模式** (仅 ESP32-S3)
  - 支持 SDMMC 1-bit/4-bit 模式，频率可达 40MHz
  - 自动降级：SDMMC 失败自动回退到 SPI 模式
  - 多频率自适应（25MHz → 10MHz → 4MHz → 1MHz）

- **IMU 传感器扩展**
  - 新增 QMI8658 传感器支持（ESP32-S3 开发板常用）
  - 保持 MPU6050 兼容性

- **SPI 总线适配**
  - ESP32-S3 使用 FSPI/SPI2_HOST
  - ESP32 保持使用 VSPI/HSPI

#### 🔧 优化改进
- 硬件抽象层 (HAL) 重构，支持多平台
- 构建脚本支持平台选择
- 显示驱动 (LovyanGFX) 双平台配置

#### 📚 文档更新
- README 更新硬件支持说明
- 新增 ESP32-S3 引脚映射表
- 更新快速开始指南

---

## [1.0.0] - 2025-12-09

### 🎉 首个正式版本发布

#### ✨ 核心特性
- **双核 FreeRTOS 架构**
  - Core 0: 专用 UI 渲染任务 (200Hz)
  - Core 1: 系统逻辑任务 (100Hz)
  - 消息队列系统和 LVGL 互斥锁保护

- **智能观鸟系统**
  - 支持多种小鸟动画，可按权重随机触发
  - 完整的统计系统，记录观鸟数据
  - 小鸟资源热加载，支持动态扩展

- **IMU 手势控制**
  - MPU6050 六轴传感器作为输入设备
  - 支持倾斜手势切换小鸟和翻页
  - RGB LED 状态反馈

- **串口命令系统**
  - 丰富的调试和控制命令
  - 实时日志管理和查看
  - 任务监控和性能分析
  - 文件上传/下载支持

- **高性能图形界面**
  - 基于 LVGL 的流畅 UI 系统
  - TFT LCD 显示支持 (240x240)
  - 自定义字体和图片资源

#### 🛠️ 开发工具
- **CybirdWatching CLI** - Python 跨平台命令行工具 (v1.0.0)
  - 交互式命令行界面
  - 文件传输功能
  - 串口自动检测和重连

- **图片/视频转换工具**
  - MP4 转小鸟动画帧
  - PNG 转二进制格式
  - 批量处理支持

#### 📦 硬件支持
- ESP32 (PICO32) / ESP32-S3 (DevKitC-1) 主控
- TFT LCD 240x240 显示屏 (ST7789)
- MPU6050 / QMI8658 六轴传感器
- WS2812B RGB LED
- Micro SD 卡存储 (SPI / SDMMC)

#### 📚 文档
- 完整的项目 README
- 双核架构设计文档
- 串口命令参考手册
- 开发指南和故障排查

---

## 版本规范

本项目遵循 [语义化版本 2.0.0](https://semver.org/lang/zh-CN/) 规范：

- **主版本号 (MAJOR)**：不兼容的 API 修改
- **次版本号 (MINOR)**：向下兼容的功能性新增
- **修订号 (PATCH)**：向下兼容的问题修正

---

## 图例

- ✨ 新特性
- 🐛 Bug 修复
- 🔧 优化改进
- 📚 文档更新
- ⚠️ 重大变更
- 🗑️ 废弃功能
- 🔒 安全修复
