# 字体字符提取工具

## 功能说明

此工具用于自动从项目配置文件中提取所有需要的中文字符，生成用于 LVGL 字体转换的字符集。

## 工作原理

脚本会自动扫描以下文件：
1. **`src/config/ui_texts.h`** - 提取所有 UI 界面显示文本
2. **`resources/configs/bird_config.csv`** - 提取所有小鸟名称

然后合并固定字符集（数字、字母、标点等），生成完整的唯一字符列表。

## 使用方法

### 1. 运行脚本

在项目根目录下执行：

```bash
python scripts/uniq_fonts/main.py
```

### 2. 查看输出

脚本会输出：
- 提取的 UI 文本列表
- 提取的小鸟名称列表
- 统计信息
- 生成的完整字符集

示例输出：
```
============================================================
🔤 字体字符提取工具
============================================================
📁 项目根目录: E:\Projects\cybird-watching\cybird-watching

📂 开始提取文本...

1️⃣  提取 UI 文本:
  📝 从 ui_texts.h 提取: 观鸟统计
  📝 从 ui_texts.h 提取: 上一页
  ...
   ✅ 共提取 6 个 UI 文本

2️⃣  提取小鸟名称:
  🐦 从 bird_config.csv 提取: [1001] 普通翠鸟
  🐦 从 bird_config.csv 提取: [1002] 白胸翡翠
  ...
   ✅ 共提取 55 个小鸟名称

============================================================
📊 统计信息:
   • UI 文本数量: 6
   • 小鸟名称数量: 55
   • 总词汇数量: 66
   • 唯一字符总数: 210
   • 中文字符数量: 118
============================================================

✨ 生成的字符集 (用于 LVGL 字体转换):
============================================================
⚠️  注意: 第一个空格字符也要复制！

 !#$%&()*+,-./0123456789:@ABCDEFGHIJKLMNOPQRSTUVWXYZ...
```

### 3. 使用生成的字符集

生成的字符集会：
1. 直接显示在终端输出中
2. 自动保存到 `scripts/uniq_fonts/font_chars.txt` 文件

### 4. LVGL 字体转换

将生成的字符集复制到 LVGL 字体转换工具中：

**在线工具**：https://lvgl.io/tools/fontconverter

**步骤**：
1. 选择字体文件（如 Noto Sans SC）
2. 设置字体大小（如 16、18）
3. 在 "Range" 选项中选择 "Custom characters"
4. 粘贴生成的字符集
5. 点击 "Convert" 生成字体文件

## 固定字符集

脚本默认包含以下固定字符：

```python
fixed_chars = [
    '0123456789',                          # 数字
    'ABCDEFGHIJKLMNOPQRSTUVWXYZ',         # 大写字母
    'abcdefghijklmnopqrstuvwxyz',         # 小写字母
    ',. !@#$%^&*()_+/-:',                 # 英文标点
    '，。？！@#￥%……&*（）——+：',          # 中文标点
]
```

## 自动化优势

✅ **无需手动维护** - 当添加新的 UI 文本或小鸟时，只需运行脚本即可  
✅ **避免遗漏** - 自动扫描所有配置文件，不会遗漏字符  
✅ **去重优化** - 自动去除重复字符，减少字体文件大小  
✅ **清晰统计** - 显示详细的提取信息和统计数据  

## 维护说明

### 添加新的 UI 文本

1. 在 `src/config/ui_texts.h` 中添加新的文本常量
2. 运行脚本重新生成字符集
3. 重新转换 LVGL 字体

### 添加新的小鸟

1. 在 `resources/configs/bird_config.csv` 中添加新的小鸟记录
2. 运行脚本重新生成字符集
3. 如果有新字符，重新转换 LVGL 字体

### 修改固定字符集

编辑 `main.py` 中的 `fixed_chars` 列表即可。

## 文件说明

- **`main.py`** - 主脚本文件
- **`font_chars.txt`** - 自动生成的字符集文件（可直接复制使用）
- **`README.md`** - 本说明文档

## 依赖

- Python 3.6+
- 标准库（无需额外安装依赖）

## 故障排除

### 问题：找不到配置文件

**解决**：确保在项目根目录下运行脚本，或检查文件路径是否正确。

### 问题：提取的字符不完整

**解决**：
1. 检查 `ui_texts.h` 中的文本格式是否为 `const char* XXX = "文本";`
2. 检查 `bird_config.csv` 格式是否正确（id, name, weight）

### 问题：某些特殊字符丢失

**解决**：手动添加到 `fixed_chars` 列表中。

## 示例输出文件

查看 `font_chars.txt` 文件内容：

```
 !#$%&()*+,-./0123456789:@ABCDEFGHIJKLMNOPQRSTUVWXYZ^_abcdefghijklmnopqrstuvwxyz—…。䴘䴙一上下乌了八冠凤加卷叉反发叶哥啄喜嘴噪夜大太头寿小尾山带恶戴拟斑新日普暗木本来松林栗次水池灰燕狗珠琵白眶眼紫红统绣绿缝翅翠翡耳胜胸脚脸腰腹苇苍苦莺蓝蛇蜂褐观角计通金银长阳隼雀雕雨页领颈鱼鳽鵟鸟鸠鸢鸦鸫鸬鸮鸰鸲鸺鸻鹃鹊鹎鹚鹞鹠鹡鹬鹭鹰黄黑！（），：？￥
```

## 版权

本工具为 CybirdWatching 项目的一部分。
